<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2022-01-27 木 11:29 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>入門統計学 検出力</title>
<meta name="author" content="suzuki@iwate-u.ac.jp 鈴木正幸，非常勤講師" />
<meta name="generator" content="Org Mode" />
<style>
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
</style>
<link rel="stylesheet" type="text/css" href="http://www.pirilampo.org/styles/bigblow/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="http://wiki.cis.iwate-u.ac.jp/~suzuki/org-html-theme/styles/bigblow/css/bigblow.css"/>
<link rel="stylesheet" type="text/css" href="http://www.pirilampo.org/styles/bigblow/css/hideshow.css"/>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/jquery-ui-1.10.2.min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/jquery.localscroll-min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/jquery.scrollTo-1.4.3.1-min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/jquery.zclip.min.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/bigblow.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/bigblow/js/hideshow.js"></script>
<script type="text/javascript" src="http://www.pirilampo.org/styles/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        displayAlign: "center",
        displayIndent: "0em",

        "HTML-CSS": { scale: 100,
                        linebreaks: { automatic: "false" },
                        webFont: "TeX"
                       },
        SVG: {scale: 100,
              linebreaks: { automatic: "false" },
              font: "TeX"},
        NativeMML: {scale: 100},
        TeX: { equationNumbers: {autoNumber: "AMS"},
               MultLineWidth: "85%",
               TagSide: "right",
               TagIndent: ".8em"
             }
});
</script>
<script src="http://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js"></script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">入門統計学 検出力</h1>

<div id="outline-container-org823293c" class="outline-2">
<h2 id="org823293c">参考サイト</h2>
<div class="outline-text-2" id="text-org823293c">
<ul class="org-ul">
<li><a href="https://staff.aist.go.jp/t.ihara/confidence.html">信頼区間と検出力</a></li>
<li><a href="https://note.com/hanaori/n/nc55ac8614799">統計学｜検出力とはなんぞや｜hanaori｜note</a></li>
<li><a href="https://multivariate-statistics.com/2021/10/16/r-programming-power-sample-size/">R言語 検出力・サンプルサイズ t検定や母比率の検定の検出力の計算</a></li>
</ul>
</div>
</div>

<div id="outline-container-org3258c6a" class="outline-2">
<h2 id="org3258c6a">仮説と過誤</h2>
<div class="outline-text-2" id="text-org3258c6a">
</div>
<div id="outline-container-org9e083c4" class="outline-3">
<h3 id="org9e083c4">丁半賭博を例にした統計的判断</h3>
<div class="outline-text-3" id="text-org9e083c4">
</div>
<div id="outline-container-orgda65195" class="outline-4">
<h4 id="orgda65195">設定</h4>
<div class="outline-text-4" id="text-orgda65195">
<ul class="org-ul">
<li>甲と乙の二人が丁半賭博に参加し，</li>
<li>二人ともなけなしのお金を勝負の度にいつ
も半に賭けたものと仮定します。</li>
</ul>
</div>
</div>

<div id="outline-container-org009db37" class="outline-4">
<h4 id="org009db37">仮説</h4>
<div class="outline-text-4" id="text-org009db37">
<ul class="org-ul">
<li>この賭博場の謳い文句はクリーンなイメージの「イカサマはいない」（仮説）
というものでした。</li>
</ul>
</div>
</div>

<div id="outline-container-org8c7cfea" class="outline-4">
<h4 id="org8c7cfea">現実</h4>
<div class="outline-text-4" id="text-org8c7cfea">
<ul class="org-ul">
<li>最初の5回までの勝負ではイカサマは行われなかったが，たまたまその日は
最初の5回，丁ばかりの目が続いた</li>

<li>6回目以降はサイコロに細工をしていつも丁が出るようなイカサマをしてい
た</li>
</ul>

<p>
とします。
</p>
</div>
</div>

<div id="outline-container-orgc5dada6" class="outline-4">
<h4 id="orgc5dada6">甲と乙のとった行動</h4>
<div class="outline-text-4" id="text-orgc5dada6">
<p>
統計的判断の考え方の基本となります。
</p>

<ul class="org-ul">
<li><p>
甲は生来アワテモノのせいか丁半勝負を始めてまだ2回しか丁が続かないのに、
この賭博はイカサマであると判断し席を蹴って退場しました。
</p>

<p>
これはイカサマをしていないという事実（仮説）が正しいのにイカサマをし
ているといった誤った判断をアワテテしてしまった過誤（error）であり、
これを「第一種の過誤」（アワテモノの誤り、 Type Ⅰ errorあるいは
error of the first kind）と言います。
</p></li>

<li><p>
それに対し、乙は生来ボンヤリモノのせいか、丁半勝負を始めてから10
回も丁の目が続いて出ているのに、博打だからまあそんなこともあるだろうと
ちっともイカサマに気付かない様子で、お金がすってんてんになるまで何度も
半を賭け続けていました。
</p>

<p>
もちろん乙の考え方は確立統計の理論からすれば10回続けて丁の目が出る確
率はだけはあり得るわけですから、謳い文句（仮説）通りイカサマが全く行
われていなかったなら、この乙の判断には間違いがなかったと言えますが、
現実には6回目以降の丁半勝負ではイカサマが行われており事実は仮説とは
違うのに、その仮説をいつまでも正しいと判断したボンヤリモノの乙の判断
にはやはり重大な過誤がります。
</p>

<p>
このような事実は間違っている（仮説は正しくない）のに仮説を正しいと判
断する過誤のことを「第二の過誤」（ボンヤリモノの誤り、Type Ⅱ error
あるいは error of the second kind）と言います。
</p></li>
</ul>
</div>
</div>

<div id="outline-container-org5e261ff" class="outline-4">
<h4 id="org5e261ff">危険率</h4>
<div class="outline-text-4" id="text-org5e261ff">
<p>
そして、甲乙いずれもその犯した過誤の時点での確率のことを「危険率」
（critical rate）と統計学では呼んでいます。
</p>

<p>
すなわち、甲の危険率（甲が第一種の過誤を犯す危険率）は
\[
  P = (1/2)^2 = 1/l4
  \]
</p>

<p>
であり、
</p>


<p>
乙の危険率（乙が第二種の過誤を犯す確率）は
</p>

<p>
\[
  P = (1/2)^10 =1/1024
  \]
</p>

<p>
ということです。
</p>
</div>
</div>
</div>
</div>


<div id="outline-container-orgcf70c06" class="outline-2">
<h2 id="orgcf70c06">検出力と期待値の差と標本サイズ</h2>
<div class="outline-text-2" id="text-orgcf70c06">
</div>
<div id="outline-container-orgf8c5e46" class="outline-3">
<h3 id="orgf8c5e46">片側検定</h3>
<div class="outline-text-3" id="text-orgf8c5e46">
<p>
危険率 0.05% として，標準正規分布の上側95%点のz値は，
</p>

<div class="org-src-container">
<pre class="src src-R">
qnorm(0.95)

</pre>
</div>

<pre class="example">
[1] 1.644854
</pre>



<p>
[[<img src="./Figs/power-oneside.jpg" alt="power-oneside.jpg" />]]
</p>



<p>
上図の\(N(\mu_0, \sigma^2)\) での a 点は，\( a = \mu_0 + 1.645 \sigma / \sqrt{n} \).
</p>

<p>
\(N(\mu, \sigma^2)\)でのa点は，\( a = \mu + z_{\a} \sigma /
\sqrt{n} \).
</p>

<p>
\(z_{a} = \frac{a-\mu}{\sigma/\sqrt{n}} = 1.645 - (\mu -
\mu_0)/\sigma/\sqrt{n} = 1.645 - \frac{\Delta\mu}{\sigma/\sqrt{n}}\)
</p>

<p>
検出力 \(1-\beta\) は， 
</p>

<p>
\( 1-\beta = P(z>=z_{a}) \) と計算できる。
</p>
</div>
</div>


<div id="outline-container-org139e1ef" class="outline-3">
<h3 id="org139e1ef">両側検定</h3>
<div class="outline-text-3" id="text-org139e1ef">
<p>
危険率 0.05% として，標準正規分布の上側97.5%点のz値は，
</p>

<div class="org-src-container">
<pre class="src src-R">
qnorm(0.975)

</pre>
</div>

<pre class="example">
[1] 1.959964
</pre>



<p>
[[<img src="./Figs/power-twoside.jpg" alt="power-twoside.jpg" />]]
</p>


<p>
上図の\(N(\mu_0, \sigma^2)\) での a 点は，\( a = \mu_0 + 1.96 \sigma /
\sqrt{n} \),
b 点は，\( b = \mu_0 - 1.96 \sigma / \sqrt{n} \).
</p>

<p>
\(N(\mu, \sigma^2)\)でのa点は，\( a = \mu + z_{a} \sigma /
\sqrt{n} \), b点は，\( b = \mu - z_b{} \sigma /
\sqrt{n} \).
</p>

<p>
\(z_{a} = \frac{a-\mu}{\sigma/\sqrt{n}} = 1.96 - (\mu -
\mu_0)/\sigma/\sqrt{n} = 1.96 - \frac{\Delta\mu}{\sigma/\sqrt{n}}\)
</p>

<p>
\(z_{b} = \frac{b-\mu}{\sigma/\sqrt{n}} = -1.96 - (\mu -
\mu_0)/\sigma/\sqrt{n} = -1.96 - \frac{\Delta\mu}{\sigma/\sqrt{n}}\)
</p>

<p>
検出力 \(1-\beta\) は， 
</p>

<p>
\( 1-\beta = P(z>=z_{a}) + P(z <= z_b \) と計算できる。
</p>
</div>
</div>
</div>

<div id="outline-container-org075ef15" class="outline-2">
<h2 id="org075ef15">power.t.test {stats}	R Documentation</h2>
<div class="outline-text-2" id="text-org075ef15">
<p>
Power calculations for one and two sample t tests
</p>
</div>

<div id="outline-container-org7be437a" class="outline-3">
<h3 id="org7be437a">Description</h3>
<div class="outline-text-3" id="text-org7be437a">
<p>
Compute the power of the one- or two- sample t test, or determine
parameters to obtain a target power.
</p>
</div>
</div>

<div id="outline-container-org8c1c82c" class="outline-3">
<h3 id="org8c1c82c">Usage</h3>
<div class="outline-text-3" id="text-org8c1c82c">
<p>
power.t.test(n = NULL, delta = NULL, sd = 1, sig.level = 0.05,
             power = NULL,
             type = c("two.sample", "one.sample", "paired"),
             alternative = c("two.sided", "one.sided"),
             strict = FALSE, tol = .Machine$double.eps^0.25)
</p>
</div>
</div>

<div id="outline-container-orga33f443" class="outline-3">
<h3 id="orga33f443">Arguments</h3>
<div class="outline-text-3" id="text-orga33f443">
<dl class="org-dl">
<dt>n</dt><dd>number of observations (per group)</dd>
<dt>delta</dt><dd>true difference in means</dd>
<dt>sd</dt><dd>standard deviation</dd>
<dt>sig.level</dt><dd>significance level (Type I error probability)</dd>
<dt>power</dt><dd>power of test (1 minus Type II error probability)</dd>
<dt>type</dt><dd>string specifying the type of t test. Can be abbreviated.</dd>
<dt>alternative</dt><dd>one- or two-sided test. Can be abbreviated.</dd>
<dt>strict</dt><dd>use strict interpretation in two-sided case</dd>
<dt>tol</dt><dd>numerical tolerance used in root finding, the default providing (at least) four significant digits.</dd>
</dl>
</div>
</div>

<div id="outline-container-org4e61a7c" class="outline-3">
<h3 id="org4e61a7c">Details</h3>
<div class="outline-text-3" id="text-org4e61a7c">
<p>
Exactly one of the parameters n, delta, power, sd, and sig.level must
be passed as NULL, and that parameter is determined from the
others. Notice that the last two have non-NULL defaults, so NULL must
be explicitly passed if you want to compute them.
</p>

<p>
If strict = TRUE is used, the power will include the probability of
rejection in the opposite direction of the true effect, in the
two-sided case. Without this the power will be half the significance
level if the true difference is zero.
</p>
</div>
</div>

<div id="outline-container-org0725a02" class="outline-3">
<h3 id="org0725a02">Value</h3>
<div class="outline-text-3" id="text-org0725a02">
<p>
Object of class "power.htest", a list of the arguments (including the computed one) augmented with method and note elements.
</p>
</div>
</div>

<div id="outline-container-org3286232" class="outline-3">
<h3 id="org3286232">Note</h3>
<div class="outline-text-3" id="text-org3286232">
<p>
uniroot is used to solve the power equation for unknowns, so you may see errors from it, notably about inability to bracket the root when invalid arguments are given.
</p>
</div>
</div>

<div id="outline-container-org772ea9e" class="outline-3">
<h3 id="org772ea9e">Author(s)</h3>
<div class="outline-text-3" id="text-org772ea9e">
<p>
Peter Dalgaard. Based on previous work by Claus Ekstrøm
</p>
</div>
</div>

<div id="outline-container-org9d55ac6" class="outline-3">
<h3 id="org9d55ac6">See Also</h3>
<div class="outline-text-3" id="text-org9d55ac6">
<p>
t.test, uniroot
</p>
</div>
</div>

<div id="outline-container-orgfaca7c9" class="outline-3">
<h3 id="orgfaca7c9">Examples</h3>
<div class="outline-text-3" id="text-orgfaca7c9">
<div class="org-src-container">
<pre class="src src-R">
 power.t.test(n = 20, delta = 1)

</pre>
</div>

<pre class="example" id="orgfee39df">

     Two-sample t test power calculation 

              n = 20
          delta = 1
             sd = 1
      sig.level = 0.05
          power = 0.8689528
    alternative = two.sided

NOTE: n is number in *each* group
</pre>

<div class="org-src-container">
<pre class="src src-R">
power.t.test(power = .90, delta = 1)

</pre>
</div>

<pre class="example" id="org6a18a05">

     Two-sample t test power calculation 

              n = 22.0211
          delta = 1
             sd = 1
      sig.level = 0.05
          power = 0.9
    alternative = two.sided

NOTE: n is number in *each* group
</pre>

<div class="org-src-container">
<pre class="src src-R">
power.t.test(power = .90, delta = 1, alternative = <span style="color: #95e454;">"one.sided"</span>)

</pre>
</div>

<pre class="example" id="org72cd04f">

     Two-sample t test power calculation 

              n = 17.84713
          delta = 1
             sd = 1
      sig.level = 0.05
          power = 0.9
    alternative = one.sided

NOTE: n is number in *each* group
</pre>

<p>
[Package stats version 4.0.3 Index]
</p>
</div>
</div>
</div>


<div id="outline-container-org7f80218" class="outline-2">
<h2 id="org7f80218">H0 と H1 の μ の差を大きくしていったとき、</h2>
<div class="outline-text-2" id="text-org7f80218">
<p>
検出力がどう変化するか R でプロットしてみます。今回サンプルサイズは 50、
分散は 1 に固定します。
</p>

<div class="org-src-container">
<pre class="src src-R">
<span style="color: #99968b;"># </span><span style="color: #99968b;">&#24179;&#22343;&#12398;&#24046; 0 ~ 1</span>
deltas <span style="color: #e5786d;">&lt;-</span> seq(0, 1, length=11) 
<span style="color: #99968b;"># </span><span style="color: #99968b;">&#20998;&#25955; 1&#12289;&#12469;&#12531;&#12503;&#12523;&#12469;&#12452;&#12474; 50 &#12398;&#26908;&#20986;&#21147;</span>
powers <span style="color: #e5786d;">&lt;-</span> power.t.test(n=50, delta=deltas, sd=1)$power

plot(deltas, powers, type=<span style="color: #95e454;">"l"</span>, xlab = <span style="color: #95e454;">"&#24179;&#22343;&#12398;&#24046;"</span>, ylab = <span style="color: #95e454;">"&#26908;&#20986;&#21147;"</span>)

</pre>
</div>


<div id="orgfc92bc1" class="figure">
<p><img src="./R-text/graph/power.png" alt="power.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-orga47a487" class="outline-2">
<h2 id="orga47a487"><a href="https://multivariate-statistics.com/2021/10/16/r-programming-power-sample-size/">R言語 検出力・サンプルサイズ t検定や母比率の検定の検出力の計算</a></h2>
<div class="outline-text-2" id="text-orga47a487">
<p>
<a href="https://multivariate-statistics.com/2021/10/16/r-programming-power-sample-size/">R言語 検出力・サンプルサイズ t検定や母比率の検定の検出力の計算</a>
</p>

<ul class="org-ul">
<li>power.t.test の計算法と実行例</li>
<li>power.prop.testの計算法と実行例</li>
<li>power.anova の計算法と実行例</li>
</ul>
</div>

<div id="outline-container-org27be697" class="outline-3">
<h3 id="org27be697">examples</h3>
<div class="outline-text-3" id="text-org27be697">
</div>
<div id="outline-container-orga26fb13" class="outline-4">
<h4 id="orga26fb13">power.t.test</h4>
<div class="outline-text-4" id="text-orga26fb13">
<p>
関数power.t.testを用いて検出力とサンプルサイズの計算を行っていきます。
</p>
</div>

<div id="outline-container-orgb151ef3" class="outline-5">
<h5 id="orgb151ef3">検出力</h5>
<div class="outline-text-5" id="text-orgb151ef3">
<p>
次を実行することで、観測数n=10、母平均の差δ=0.1、標準偏差σ=0.05、第一の過誤α=0.05のときのt検定の検出力を計算することができます。
</p>


<div class="org-src-container">
<pre class="src src-R">n <span style="color: #e5786d;">&lt;-</span> 10  <span style="color: #99968b;"># </span><span style="color: #99968b;">&#12469;&#12531;&#12503;&#12523;&#12469;&#12452;&#12474;</span>
alpha <span style="color: #e5786d;">&lt;-</span> 0.05 <span style="color: #99968b;"># </span><span style="color: #99968b;">&#21361;&#38522;&#29575;</span>
delta <span style="color: #e5786d;">&lt;-</span> 0.1  <span style="color: #99968b;"># </span><span style="color: #99968b;">&#24179;&#22343;&#20516;&#12398;&#24046;</span>
sd <span style="color: #e5786d;">&lt;-</span> 0.05    <span style="color: #99968b;"># </span><span style="color: #99968b;">&#27161;&#28310;&#20559;&#24046;</span>
 
(power <span style="color: #e5786d;">&lt;-</span> power.t.test(n = n, delta = delta, sd = sd, sig.level = alpha))
</pre>
</div>

<pre class="example" id="org2b2a41b">

     Two-sample t test power calculation 

              n = 10
          delta = 0.1
             sd = 0.05
      sig.level = 0.05
          power = 0.988179
    alternative = two.sided

NOTE: n is number in *each* group
</pre>

<p>
powerを参照すると検出力=0.988179であることが分かります。
</p>
</div>
</div>

<div id="outline-container-org1daeb74" class="outline-5">
<h5 id="org1daeb74">結果の利用</h5>
<div class="outline-text-5" id="text-org1daeb74">
<p>
power.t.testの返り値はリスト型となっており、観測数n=20や検出力1−βの値がリストの要素として格納されています。
</p>

<p>
次のようにして検出力やそのほかのパラメータを取得することが可能です。
</p>

<div class="org-src-container">
<pre class="src src-R">power$n         <span style="color: #99968b;">#</span><span style="color: #99968b;">&#35251;&#28204;&#25968;:n</span>
power$delta     <span style="color: #99968b;">#</span><span style="color: #99968b;">&#20206;&#35500;&#26908;&#23450;&#12398;2&#32676;&#38291;&#12398;&#24046;:&#948;</span>
power$sd        <span style="color: #99968b;">#</span><span style="color: #99968b;">&#27161;&#28310;&#20559;&#24046;</span>
power$sig.level <span style="color: #99968b;">#</span><span style="color: #99968b;">&#26377;&#24847;&#27700;&#28310;:&#945;</span>
power$power     <span style="color: #99968b;">#</span><span style="color: #99968b;">&#26908;&#20986;&#21147;:1-&#946;</span>

</pre>
</div>

<pre class="example">
[1] 10
[1] 0.1
[1] 0.05
[1] 0.05
[1] 0.988179
</pre>


<p>
次のように、power.t.testによって計算された値をデータフレームに格納すると、csvなどに表として出力するとき便利です。
</p>

<div class="org-src-container">
<pre class="src src-R">
(powerResult <span style="color: #e5786d;">&lt;-</span> data.frame(n = power$n, delta = power$delta, sd = power$sd,
                           alpha = power$sig.level, power = power$power))

</pre>
</div>

<pre class="example">
   n delta   sd alpha    power
1 10   0.1 0.05  0.05 0.988179
</pre>



<p>
write.csvを使ってpowerResultを出力すると次の画像のcsvファイルが保存されているのが確認できます。
</p>

<div class="org-src-container">
<pre class="src src-R"> 
write.csv(<span style="color: #95e454;">"power.t.test.csv"</span>, powerResult)

</pre>
</div>

<pre class="example">
isOpen(file, "w") でエラー:  コネクションが不正です 
追加情報:  警告メッセージ: 
if (file == "") file &lt;- stdout() else if (is.character(file)) { で: 
  条件が長さが 2 以上なので、最初の 1 つだけが使われます
</pre>
</div>
</div>


<div id="outline-container-org78d9af4" class="outline-5">
<h5 id="org78d9af4">サンプルサイズの計算法</h5>
<div class="outline-text-5" id="text-org78d9af4">
<p>
検出力が与えられたときのサンプルサイズは power.t.test のn以外のパラメー
タを与えることで計算できます。
</p>

<p>
次を実行することで、母平均の差δ=0.1、標準偏差σ=0.05、第一の過誤α=0.05のとき検出力が0.9を超えるようなサンプルサイズを計算することができます。
</p>

<div class="org-src-container">
<pre class="src src-R">beta <span style="color: #e5786d;">&lt;-</span> 0.1
power <span style="color: #e5786d;">&lt;-</span> power.t.test(delta = delta, sd = sd, sig.level = alpha, power = 1 - beta)
power$n <span style="color: #99968b;">#</span><span style="color: #99968b;">&#12469;&#12531;&#12503;&#12523;&#12469;&#12452;&#12474;</span>
</pre>
</div>

<pre class="example">
[1] 6.386756
</pre>


<p>
powerを参照するとサンプルサイズは6.386756であることが分かりました。
</p>

<div class="org-src-container">
<pre class="src src-R">
power
 
</pre>
</div>

<pre class="example" id="org0243f3b">

     Two-sample t test power calculation 

              n = 6.386756
          delta = 0.1
             sd = 0.05
      sig.level = 0.05
          power = 0.9
    alternative = two.sided

NOTE: n is number in *each* group
</pre>
</div>
</div>


<div id="outline-container-orgd7bb2d2" class="outline-5">
<h5 id="orgd7bb2d2">グラフによる確認</h5>
<div class="outline-text-5" id="text-orgd7bb2d2">
<p>
実際に検出力と観測数についてのグラフを描くと上で計算したサンプルサイズ
が正しいことが確認できます。
</p>

<div class="org-src-container">
<pre class="src src-R">
powers <span style="color: #e5786d;">&lt;-</span>
  sapply(seq_len(50),
         <span style="color: #8ac6f2; font-weight: bold;">function</span>(x) {
           power <span style="color: #e5786d;">&lt;-</span> power.t.test(n = x, delta = delta, sd = sd, sig.level = alpha)
           power$power
         })
 
plot(powers, type = <span style="color: #95e454;">"l"</span>, xlab = <span style="color: #95e454;">"n"</span>, ylab= <span style="color: #95e454;">"Power"</span>)

</pre>
</div>


<div id="org45f59a0" class="figure">
<p><img src="power-t-test-plot.png" alt="power-t-test-plot.png" />
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc57377e" class="outline-4">
<h4 id="orgc57377e">power.anova.test</h4>
<div class="outline-text-4" id="text-orgc57377e">
</div>
<div id="outline-container-org569c36e" class="outline-5">
<h5 id="org569c36e">検出力</h5>
<div class="outline-text-5" id="text-org569c36e">
<p>
引数に検定で用いるパラメータや第一の過誤を設定することで実行できます。
</p>

<p>
次を実行すると、群の数k=4、観測数n=10、群間の分散σ2B=0.01、群内の分散
σ2W=0.025、第一の過誤α=0.05のときの母比率の差の検定の検出力を計算す
ることができます。
</p>

<div class="org-src-container">
<pre class="src src-R">
n <span style="color: #e5786d;">&lt;-</span> 10
alpha <span style="color: #e5786d;">&lt;-</span> 0.05
numberOfGroups <span style="color: #e5786d;">&lt;-</span> 4
sigmaB <span style="color: #e5786d;">&lt;-</span> 0.01 <span style="color: #99968b;">#</span><span style="color: #99968b;">&#32676;&#38291;&#12398;&#20998;&#25955;</span>
sigmaW <span style="color: #e5786d;">&lt;-</span> 0.025 <span style="color: #99968b;">#</span><span style="color: #99968b;">&#32676;&#20869;&#12398;&#20998;&#25955;</span>
 
power <span style="color: #e5786d;">&lt;-</span> power.anova.test(groups = numberOfGroups, n = n, between.var = sigmaB,
                          within.var = sigmaW, sig.level = alpha)
</pre>
</div>

<p>
powerを参照すると検出力=0.7942482であることが確認できます。
</p>

<div class="org-src-container">
<pre class="src src-R"> 
power

</pre>
</div>

<pre class="example" id="org857a7ae">

     Balanced one-way analysis of variance power calculation 

         groups = 4
              n = 10
    between.var = 0.01
     within.var = 0.025
      sig.level = 0.05
          power = 0.7942482

NOTE: n is number in each group
</pre>

<p>
他の関数と同様に検出力などの値はリストの要素として格納されている多め、powerのうしろに$を付けることで各値を取得することが可能です。
</p>

<div class="org-src-container">
<pre class="src src-R">class(power)
power$groups      <span style="color: #99968b;">#</span><span style="color: #99968b;">&#32676;&#12398;&#25968;</span>
power$n           <span style="color: #99968b;">#</span><span style="color: #99968b;">&#35251;&#28204;&#25968;</span>
power$between.var <span style="color: #99968b;">#</span><span style="color: #99968b;">&#32676;&#38291;&#12398;&#20998;&#25955;</span>
power$within.var  <span style="color: #99968b;">#</span><span style="color: #99968b;">&#32676;&#20869;&#12398;&#20998;&#25955;</span>
power$sig.level   <span style="color: #99968b;">#</span><span style="color: #99968b;">&#26377;&#24847;&#27700;&#28310;:&#945;</span>
power$power       <span style="color: #99968b;">#</span><span style="color: #99968b;">&#26908;&#20986;&#21147;:1-&#946;</span>
</pre>
</div>

<pre class="example">
[1] "power.htest"
[1] 4
[1] 10
[1] 0.01
[1] 0.025
[1] 0.05
[1] 0.7942482
</pre>


<div class="org-src-container">
<pre class="src src-R">
powerResult <span style="color: #e5786d;">&lt;-</span> data.frame(No.groups = power$groups, n = power$n, sigmaB = power$between.var,
                           sigmaW = power$within.var, alpha = power$sig.level, power = power$power)
powerResult
</pre>
</div>
</div>
</div>

<div id="outline-container-org12c054d" class="outline-5">
<h5 id="org12c054d">サンプルサイズ</h5>
<div class="outline-text-5" id="text-org12c054d">
<p>
サンプルサイズも他の関数と同様に観測数以外の引数を与えてあげることで計算することができます。
</p>

<p>
以下、群の数k=4、群間の分散σ2B=0.01、群内の分散σ2W=0.025、第一の過誤
α=0.05のとき検出力が0.9を超えるようなサンプルサイズを計算する例です。
</p>

<div class="org-src-container">
<pre class="src src-R">
power <span style="color: #e5786d;">&lt;-</span> power.anova.test(groups = numberOfGroups, between.var = sigmaB,
                          within.var = sigmaW, sig.level = alpha, power = 1 - beta)
power$n <span style="color: #99968b;">#</span><span style="color: #99968b;">&#12469;&#12531;&#12503;&#12523;&#12469;&#12452;&#12474;</span>
</pre>
</div>

<pre class="example">
[1] 12.83399
</pre>


<div class="org-src-container">
<pre class="src src-R"> 
power
</pre>
</div>

<pre class="example" id="org7ae1bc2">

     Balanced one-way analysis of variance power calculation 

         groups = 4
              n = 12.83399
    between.var = 0.01
     within.var = 0.025
      sig.level = 0.05
          power = 0.9

NOTE: n is number in each group
</pre>

<p>
サンプルサイズ=12.83399であり、観測数n=10のときと比較すると検出力が0.9
を超えるためにはあと3標本足りないことがわかりました。
</p>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: suzuki@iwate-u.ac.jp 鈴木正幸，非常勤講師</p>
<p class="date">Created: 2022-01-27 木 11:29</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
